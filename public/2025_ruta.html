<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Ruta</title>
    <link rel="stylesheet" href="2025_ruta.css">
</head>

<body>
    <!-- Barra fija -->
    <div id="nav"></div>
    <div id="sep"></div>
    <h1 id="titulo"></h1>

    <!-- Galería -->
    <div id="galeria">
        <div id="miniaturas"></div>
        <div id="foto-grande"></div>
    </div>

    <script>
        let rutas = {};
        let miniaturas;
        let fotoGrande;

        fetch("2025_rutas.json")
            .then(r => r.json())
            .then(data => {
                rutas = data;
                iniciarPagina();
            });

        function iniciarPagina() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get("id");
            const carpeta = rutas[id];

            document.getElementById("titulo").textContent = carpeta || "Ruta no encontrada";

            miniaturas = document.getElementById("miniaturas");
            fotoGrande = document.getElementById("foto-grande");

            let primera = true;

            for (let i = 1; i <= 200; i++) {
                const src = `fotos/${carpeta}/${id} (${i}).jpg`;

                const img = new Image();
                img.src = src;

                img.onload = () => {
                    const thumb = new Image();
                    thumb.src = src;

                    thumb.onclick = () => mostrarFoto(src, thumb);

                    miniaturas.appendChild(thumb);

                    if (primera) {
                        mostrarFoto(src, thumb);
                        primera = false;
                    }
                };
            }
            crearNavegacion(id);
        }

        function mostrarFoto(src, thumb) {
            fotoGrande.innerHTML = `<img src="${src}">`;

            document.querySelectorAll("#miniaturas img").forEach(t => t.classList.remove("activa"));
            thumb.classList.add("activa");
        }

        /* Navegación fija con flechas */
        function crearNavegacion(idActual) {
            const nav = document.getElementById("nav");
            const idNum = parseInt(idActual);
            const prev = idNum > 1 ? String(idNum - 1).padStart(2, "0") : null;
            const next = idNum < 29 ? String(idNum + 1).padStart(2, "0") : null;

            let html = "";

            html += prev
                ? `<a href="2025_ruta.html?id=${prev}" style="color:white;text-decoration:none;">⬅️</a>`
                : `<span style="opacity:0.4;">⬅️</span>`;

            html += `
                    <select id="selectorRuta">
                        ${Object.keys(rutas)
                    .sort((a, b) => Number(a) - Number(b))
                    .map(id => `<option value="${id}" ${id === idActual ? "selected" : ""}>${rutas[id]}</option>`)
                    .join("")}
                    </select>
                `;

            html += next
                ? `<a href="2025_ruta.html?id=${next}" style="color:white;text-decoration:none;">➡️</a>`
                : `<span style="opacity:0.4;">➡️</span>`;

            nav.innerHTML = html;

            document.getElementById("selectorRuta").onchange = function () {
                location.href = "2025_ruta.html?id=" + this.value;
            };
        }
    </script>

</body>
</html>
